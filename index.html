<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üì∏ Fotos Aluche + Tiempo REAL + Calendario</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { height: 100vh; overflow: hidden; background: #000; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; color: white; }
    
    #slideshow { position: fixed; inset: 0; display: none; }
    #slideshow.activo { display: block; }
    .foto { width: 100vw; height: 100vh; object-fit: cover; display: none; opacity: 0; transition: opacity 1s; }
    .foto.activa { display: block; opacity: 1; }
    .foto.error { opacity: 0.3; background: #222; }
    
    #calendario { position: fixed; inset: 0; display: none; background: #111; flex-direction: column; }
    #calendario.activo { display: flex; }
    #mes { display: flex; justify-content: space-between; padding: 20px; font-size: 24px; font-weight: bold; background: #222; }
    #grid-dias { display: grid; grid-template-columns: repeat(7,1fr); gap: 4px; padding: 10px; flex: 1; overflow-y: auto; }
    .dia { padding: 12px 4px; border-radius: 8px; text-align: center; background: #222; cursor: pointer; font-size: 14px; }
    .dia.activo { background: #007AFF; }
    .dia.vacio { background: transparent; cursor: default; }
    .evento { margin-top: 4px; font-size: 11px; }
    
    /* BANNER NUEVO: IZQ hora/fecha | DER tiempo Aluche */
    #banner { 
      position: fixed; bottom: 0; left: 0; right: 0; 
      height: 45px; display: flex; justify-content: space-between; align-items: center;
      background: linear-gradient(to top, #000D, transparent); 
      padding: 0 20px; backdrop-filter: blur(12px); font-weight: 500;
      border-top: 1px solid #3333; 
    }
    #hora-fecha { text-align: left; min-width: 0; }
    #hora { font-size: 18px; font-weight: bold; margin-bottom: 1px; }
    #fecha { font-size: 13px; opacity: 0.85; }
    #tiempo-aluche { text-align: right; min-width: 0; }
    #tiempo-main { font-size: 15px; font-weight: bold; margin-bottom: 1px; }
    #tiempo-desc { font-size: 12px; opacity: 0.8; }
    
    #config { position: fixed; top: 20px; right: 20px; background: #333; padding: 15px; border-radius: 12px; display: none; z-index: 1000; }
    #config.activo { display: block; }
    label { display: block; margin-bottom: 10px; font-size: 14px; }
    input { width: 60px; padding: 4px; background: #444; color: white; border: none; border-radius: 4px; }
    button { background: #007AFF; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; margin-top: 10px; }
    .dia:active, button:active { transform: scale(0.98); }
  </style>
</head>
<body>
  <div id="slideshow">
    <!-- TUS FOTOS GOOGLE: reemplaza links -->
    <img id="foto1" class="foto" data-src="https://photos.app.goo.gl/TU_LINK1?w1920-h1080" alt="Foto 1">
    <img id="foto2" class="foto" data-src="https://photos.app.goo.gl/TU_LINK2?w1920-h1080" alt="Foto 2">
    <img id="foto3" class="foto" data-src="https://photos.app.goo.gl/TU_LINK3?w1920-h1080" alt="Foto 3">
  </div>
  
  <div id="calendario">
    <div id="mes"></div>
    <div id="grid-dias"></div>
  </div>
  
  <!-- BANNER DISTRIBUIDO -->
  <div id="banner">
    <div id="hora-fecha">
      <div id="hora">--:--</div>
      <div id="fecha">-----</div>
    </div>
    <div id="tiempo-aluche">
      <div id="tiempo-main">Cargando Aluche...</div>
      <div id="tiempo-desc">--¬∞C</div>
    </div>
  </div>
  
  <div id="config">
    <label>Tiempo foto (s): <input id="tiempoInput" type="number" value="10" min="5" max="60"></label>
    <button onclick="guardarConfig()">Guardar</button>
  </div>

  <script>
    let tiempoFoto = 10000, fotoActual = 1, numFotos = 3, calendarioAbierto = false, timeoutFoto;
    const LAT_ALUCHE = 40.393, LON_ALUCHE = -3.756;
    const WEATHER_KEY = '061eaa539b2f8f2eecfa8836f7a48c34';
    const iconos = { Clear: '‚òÄÔ∏è', Clouds: '‚òÅÔ∏è', Rain: 'üåßÔ∏è', Snow: '‚ùÑÔ∏è', Thunderstorm: '‚õàÔ∏è', Drizzle: 'üå¶Ô∏è', Mist: 'üå´Ô∏è' };
    
    window.addEventListener('load', () => {
      document.getElementById('slideshow').classList.add('activo');
      precargarFotos();
      cargarFotos();
      actualizarReloj();
      cargarTiempo();
      setInterval(cargarTiempo, 1800000);
      setInterval(actualizarReloj, 1000);
      document.addEventListener('click', toggleCalendario);
      document.addEventListener('touchstart', toggleCalendario);
      document.querySelector('#slideshow').addEventListener('touchstart', (e) => e.preventDefault(), {passive: false});
      document.getElementById('config').addEventListener('click', (e) => e.stopPropagation());
      document.addEventListener('contextmenu', mostrarConfig);
    });
    
    function precargarFotos() {
      document.querySelectorAll('.foto').forEach((foto) => {
        const img = new Image();
        img.onload = () => foto.dataset.loaded = 'true';
        img.onerror = () => foto.dataset.loaded = 'false';
        img.src = foto.dataset.src;
        foto.src = foto.dataset.src;
      });
    }
    
    function cargarFotos() {
      clearTimeout(timeoutFoto);
      document.querySelectorAll('.foto').forEach(f => {
        f.classList.remove('activa', 'error');
        f.style.opacity = '0';
      });
      const fotoEl = document.getElementById(`foto${fotoActual}`);
      fotoEl.classList.add('activa');
      if (fotoEl.dataset.loaded === 'false') {
        fotoEl.classList.add('error');
        fotoActual = (fotoActual % numFotos) + 1;
        setTimeout(cargarFotos, 2000);
        return;
      }
      fotoActual = (fotoActual % numFotos) + 1;
      timeoutFoto = setTimeout(cargarFotos, tiempoFoto);
    }
    
    function toggleCalendario() {
      calendarioAbierto = !calendarioAbierto;
      document.getElementById('slideshow').classList.toggle('activo', !calendarioAbierto);
      document.getElementById('calendario').classList.toggle('activo', calendarioAbierto);
      if (calendarioAbierto) generarCalendario();
      else setTimeout(cargarFotos, 30000);
    }
    
    function generarCalendario() {
      const hoy = new Date();
      const mes = hoy.getMonth(), year = hoy.getFullYear();
      document.getElementById('mes').textContent = `${hoy.toLocaleDateString('es-ES',{month:'long'}).toUpperCase()} ${year}`;
      const primerDia = new Date(year, mes, 1).getDay();
      const diasMes = new Date(year, mes + 1, 0).getDate();
      const grid = document.getElementById('grid-dias');
      grid.innerHTML = '';
      for (let i = 0; i < primerDia; i++) {
        const div = document.createElement('div'); div.className = 'dia vacio'; grid.appendChild(div);
      }
      for (let dia = 1; dia <= diasMes; dia++) {
        const div = document.createElement('div');
        div.className = 'dia'; div.textContent = dia;
        if (dia === hoy.getDate() && mes === hoy.getMonth()) div.classList.add('activo');
        div.onclick = () => alert(`Evento d√≠a ${dia}`);
        grid.appendChild(div);
      }
    }
    
    async function cargarTiempo() {
      try {
        const url = `https://api.openweathermap.org/data/2.5/weather?lat=${LAT_ALUCHE}&lon=${LON_ALUCHE}&appid=${WEATHER_KEY}&units=metric&lang=es`;
        const res = await fetch(url);
        if (!res.ok) throw new Error(`Error ${res.status}`);
        const data = await res.json();
        const temp = Math.round(data.main.temp);
        const iconKey = data.weather[0].main;
        const icon = iconos[iconKey] || 'üå§Ô∏è';
        const desc = data.weather[0].description;
        document.getElementById('tiempo-main').textContent = `Aluche ${temp}¬∞C ${icon}`;
        document.getElementById('tiempo-desc').textContent = desc;
      } catch (error) {
        document.getElementById('tiempo-main').textContent = 'Aluche --';
        document.getElementById('tiempo-desc').textContent = 'No disponible';
      }
    }
    
    function actualizarReloj() {
      const ahora = new Date();
      document.getElementById('hora').textContent = ahora.toLocaleTimeString('es-ES');
      document.getElementById('fecha').textContent = ahora.toLocaleDateString('es-ES', {weekday:'short', day:'numeric', month:'short'});
    }
    
    function mostrarConfig(e) {
      e.preventDefault();
      document.getElementById('config').classList.toggle('activo');
    }
    
    function guardarConfig() {
      tiempoFoto = parseInt(document.getElementById('tiempoInput').value) * 1000;
      document.getElementById('config').classList.remove('activo');
      cargarFotos();
    }
  </script>
</body>
</html>
