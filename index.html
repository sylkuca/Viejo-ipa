<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üì∏ Fotos Aluche + Tiempo REAL + Calendario</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { height: 100vh; overflow: hidden; background: #000; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; color: white; }
    
    /* Slideshow */
    #slideshow { position: fixed; inset: 0; display: none; }
    #slideshow.activo { display: block; }
    .foto { width: 100vw; height: 100vh; object-fit: cover; display: none; }
    .foto.activa { display: block; }
    
    /* Calendario */
    #calendario { position: fixed; inset: 0; display: none; background: #111; flex-direction: column; }
    #calendario.activo { display: flex; }
    #mes { display: flex; justify-content: space-between; padding: 20px; font-size: 24px; font-weight: bold; background: #222; }
    #grid-dias { display: grid; grid-template-columns: repeat(7,1fr); gap: 4px; padding: 10px; flex: 1; overflow-y: auto; }
    .dia { padding: 12px 4px; border-radius: 8px; text-align: center; background: #222; cursor: pointer; font-size: 14px; }
    .dia.activo { background: #007AFF; }
    .dia.vacio { background: transparent; cursor: default; }
    .evento { margin-top: 4px; font-size: 11px; }
    
    /* Banner inferior (3 l√≠neas: tiempo + reloj + fecha) */
    #banner { 
      position: fixed; bottom: 0; left: 0; right: 0; 
      background: linear-gradient(to top, #0008, transparent); 
      padding: 12px 20px; font-size: 14px; line-height: 1.3; 
      backdrop-filter: blur(10px); 
    }
    #tiempo { font-weight: bold; margin-bottom: 2px; }
    #reloj { font-size: 16px; }
    #fecha { font-size: 12px; opacity: 0.8; }
    
    /* Configuraci√≥n (esquina superior derecha) */
    #config { position: fixed; top: 20px; right: 20px; background: #333; padding: 15px; border-radius: 12px; display: none; z-index: 1000; }
    #config.activo { display: block; }
    label { display: block; margin-bottom: 10px; font-size: 14px; }
    input { width: 60px; padding: 4px; background: #444; color: white; border: none; border-radius: 4px; }
    button { background: #007AFF; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; margin-top: 10px; }
    
    /* Touch feedback */
    .dia:active, button:active { transform: scale(0.98); }
  </style>
</head>
<body>
  <!-- Slideshow -->
  <div id="slideshow">
    <img id="foto1" class="foto" src="https://picsum.photos/1920/1080?random=1" alt="Foto 1">
    <img id="foto2" class="foto" src="https://picsum.photos/1920/1080?random=2" alt="Foto 2">
    <img id="foto3" class="foto" src="https://picsum.photos/1920/1080?random=3" alt="Foto 3">
    <!-- A√±ade m√°s fotos reales de tu √°lbum Google Photos aqu√≠ -->
  </div>
  
  <!-- Calendario -->
  <div id="calendario">
    <div id="mes"></div>
    <div id="grid-dias"></div>
  </div>
  
  <!-- Banner inferior -->
  <div id="banner">
    <div id="tiempo">Cargando tiempo Aluche...</div>
    <div id="reloj">--:--</div>
    <div id="fecha">-----</div>
  </div>
  
  <!-- Configuraci√≥n -->
  <div id="config">
    <label>Tiempo foto (s): <input id="tiempoInput" type="number" value="10" min="5" max="60"></label>
    <button onclick="guardarConfig()">Guardar</button>
  </div>

  <script>
    // Configuraci√≥n
    let tiempoFoto = 10000; // 10s default
    let fotoActual = 1;
    let calendarioAbierto = false;
    let timeoutFoto;
    
    // Coordenadas PRECISAS Aluche (Madrid) [web:16]
    const LAT_ALUCHE = 40.393;
    const LON_ALUCHE = -3.756;
    
    // NUEVA API KEY OpenWeatherMap
    const WEATHER_KEY = '061eaa539b2f8f2eecfa8836f7a48c34';
    
    // Iconos tiempo (mapeo weather.main + icon)
    const iconos = {
      'Clear': '‚òÄÔ∏è', 'Sun': '‚òÄÔ∏è',
      'Clouds': '‚òÅÔ∏è', 'Partly': '‚õÖ',
      'Rain': 'üåßÔ∏è', 'Drizzle': 'üå¶Ô∏è',
      'Thunderstorm': '‚õàÔ∏è',
      'Snow': '‚ùÑÔ∏è', 'Mist': 'üå´Ô∏è', 'Fog': 'üå´Ô∏è', 'Haze': 'üå´Ô∏è'
    };
    
    // Inicializar
    window.addEventListener('load', function(){
      document.getElementById('slideshow').classList.add('activo');
      document.getElementById('calendario').classList.remove('activo');
      cargarFotos();
      actualizarReloj();
      cargarTiempo();
      setInterval(cargarTiempo, 1800000); // 30min
      setInterval(actualizarReloj, 1000);
      
      // Eventos touch universal
      document.addEventListener('click', toggleCalendario);
      document.addEventListener('touchstart', toggleCalendario);
      document.querySelector('#slideshow').addEventListener('touchstart', (e) => e.preventDefault(), {passive: false});
      
      // Configuraci√≥n esquina
      document.getElementById('config').addEventListener('click', (e) => e.stopPropagation());
      // Toque esquina superior derecha abre config (para tablets)
      document.addEventListener('contextmenu', mostrarConfig);
    });
    
    // Slideshow
    function cargarFotos() {
      clearTimeout(timeoutFoto);
      const fotos = document.querySelectorAll('.foto');
      fotos.forEach(f => f.classList.remove('activa'));
      document.getElementById(`foto${fotoActual}`).classList.add('activa');
      fotoActual = fotoActual % 3 + 1; // Ciclo 1-2-3
      timeoutFoto = setTimeout(cargarFotos, tiempoFoto);
    }
    
    // Calendario b√°sico (mes actual)
    function toggleCalendario() {
      calendarioAbierto = !calendarioAbierto;
      document.getElementById('slideshow').classList.toggle('activo', !calendarioAbierto);
      document.getElementById('calendario').classList.toggle('activo', calendarioAbierto);
      if (calendarioAbierto) generarCalendario();
      else setTimeout(cargarFotos, 30000); // Vuelve fotos en 30s
    }
    
    function generarCalendario() {
      const hoy = new Date();
      const mes = hoy.getMonth();
      const year = hoy.getFullYear();
      document.getElementById('mes').textContent = `${hoy.toLocaleDateString('es-ES',{month:'long'}).toUpperCase()} ${year}`;
      
      const primerDia = new Date(year, mes, 1).getDay();
      const diasMes = new Date(year, mes + 1, 0).getDate();
      const grid = document.getElementById('grid-dias');
      grid.innerHTML = '';
      
      // D√≠as vac√≠os
      for (let i = 0; i < primerDia; i++) {
        const div = document.createElement('div');
        div.className = 'dia vacio';
        grid.appendChild(div);
      }
      
      // D√≠as mes
      for (let dia = 1; dia <= diasMes; dia++) {
        const div = document.createElement('div');
        div.className = 'dia';
        div.textContent = dia;
        if (dia === hoy.getDate() && mes === hoy.getMonth()) div.classList.add('activo');
        div.onclick = () => alert(`Evento d√≠a ${dia}`); // Personaliza eventos
        grid.appendChild(div);
      }
    }
    
    // TIEMPO REAL Aluche OpenWeatherMap [page:0]
    async function cargarTiempo() {
      try {
        const url = `https://api.openweathermap.org/data/2.5/weather?lat=${LAT_ALUCHE}&lon=${LON_ALUCHE}&appid=${WEATHER_KEY}&units=metric&lang=es`;
        const res = await fetch(url);
        if (!res.ok) throw new Error(`Error ${res.status}`);
        const data = await res.json();
        
        const temp = Math.round(data.main.temp);
        const desc = data.weather[0].description;
        const icon = iconos[data.weather[0].main] || 'üå§Ô∏è';
        
        document.getElementById('tiempo').textContent = `Aluche: ${temp}¬∞C ${icon} ${desc}`;
      } catch (error) {
        console.error('Tiempo error:', error);
        document.getElementById('tiempo').textContent = 'Aluche: Tiempo no disponible';
      }
    }
    
    // Reloj + fecha
    function actualizarReloj() {
      const ahora = new Date();
      document.getElementById('reloj').textContent = ahora.toLocaleTimeString('es-ES');
      document.getElementById('fecha').textContent = ahora.toLocaleDateString('es-ES', {weekday:'short', day:'numeric', month:'short'});
    }
    
    // Config
    function mostrarConfig(e) {
      e.preventDefault();
      document.getElementById('config').classList.toggle('activo');
    }
    function guardarConfig() {
      tiempoFoto = parseInt(document.getElementById('tiempoInput').value) * 1000;
      document.getElementById('config').classList.remove('activo');
      cargarFotos(); // Reinicia timer
    }
  </script>
</body>
</html>

